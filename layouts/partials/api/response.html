{{/* api/response.html expects a context with:
     - .reference: Reference object containing shared data
     - .path: The API path
     - .method: The HTTP method
     - .statusCode: the HTTP status code
    - .response: The response object
*/}}
{{- $reference := .reference }}
{{- $path := .path }}
{{- $method := .method }}
{{- $statusCode := .statusCode }}
{{- $response := .response }}
{{- $schemas := .reference.components.schemas }}
{{- $bg := "" }}
{{- if or (eq $statusCode "200") (eq $statusCode "204") }}
    {{- $bg = "bg-green-100" }}
{{- else }}
    {{- $bg = "bg-red-100" }}
{{- end }}
{{- with $response}}
<div class="flex flex-col">
    <div class="space-y-2">
        <h5 class="{{$bg}} p-2 rounded">{{ $statusCode }} <span class="font-thin">{{- .description }}</span></h5>
        {{- $appjson := index .content "application/json"}}
        {{- range $refType, $responseItem := $appjson.schema }}
        {{- if reflect.IsMap $responseItem }}
            <!-- Handle case where $responseItem is a map of $refs -->
        This is a map: {{.}}
        {{else if reflect.IsSlice $responseItem}}
        <!-- Handle case where $responseItem is a $ref '#/components/responses/...' -->
        This is a slice: {{.}}
        {{else }}
        <!-- Handle case where $responseItem is a $ref '#/components/responses/...' -->
        {{ $path := strings.TrimPrefix "#/components/schemas/" . }}
        {{- with (index $schemas $path) }}
        <div class="bg-blue-100 p-2 rounded">
            {{if reflect.IsMap . }}
            <p class="font-bold">{{.type}}</p>
            <ul class="space-y-2">
                {{- range $key, $schema := .properties }}
                <!-- Likely reusable for map and slice once we get to .properties of each-->
                <li class="space-y-1">
                    <span class="font-medium">{{$key}}</span>
                    {{with $schema }}
                    {{- with .type}}
                    <span class="font-thin">{{.}}</span>
                    {{- end}}
                    {{- with .format}}
                    <span class="font-thin">({{.}})</span>
                    {{- end}}
                    <div class="pl-2 space-y-1">
                        {{with .description}}
                        <p class="text-sm">{{. | markdownify }}</p>
                        {{end}}
                        {{- with .example}}
                        <p class="text-xs"><span class="font-bold">Examples:</span> {{.}}</p>
                        {{- end}}
                        {{- with .enum}}
                        <p class="text-xs"><span class="font-bold">Enums:</span> {{.}}</p>
                        {{- end}}
                    </div>
                    {{- end }}
                    {{- $schemaRef := index $schema "$ref"}}
                    <!-- loop becomes more obvious here; i think we need a template --> 
                    {{ $path := strings.TrimPrefix "#/components/schemas/" $schemaRef }}
                    {{- with (index $schemas $path) }}
                    {{end}}
       
                </li>
                {{- end }}
            </ul>
            {{- else if reflect.IsSlice . }}
            <!-- likey never used but here just in case -->
            {{- else }}
            <!-- likey never used but here just in case -->
            {{- end }}
        </div>
        {{- end }}
        {{- end }}
        {{- end }}
    </div>
</div>
{{- end}}


